<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="EcoSentinel AI - Community-Driven Environmental Risk Intelligence Platform" />
    <meta name="keywords" content="environmental intelligence, climate action, Kenya, UNEP, AI, flooding, air quality, deforestation" />
    <meta name="author" content="Gideon Kiprono" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate icon" type="image/png" href="/favicon.png" />
    <title>EcoSentinel AI - Environmental Risk Intelligence Platform</title>
    
    <!-- Google Fonts for better typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
      :root {
        /* EcoSentinel AI Brand Colors */
        --eco-primary: #40A957;
        --eco-secondary: #2E7D32;
        --eco-accent: #4CAF50;
        --eco-danger: #F44336;
        --eco-warning: #FF9800;
        --eco-info: #2196F3;
        --eco-success: #4CAF50;
        
        /* Background and surfaces */
        --eco-bg-primary: #FAFAFA;
        --eco-bg-secondary: #FFFFFF;
        --eco-bg-tertiary: #F5F5F5;
        --eco-surface: #FFFFFF;
        --eco-surface-variant: #E8F5E8;
        
        /* Text colors */
        --eco-text-primary: #1B1B1B;
        --eco-text-secondary: #666666;
        --eco-text-tertiary: #999999;
        --eco-text-on-primary: #FFFFFF;
        
        /* Borders and dividers */
        --eco-border: #E0E0E0;
        --eco-border-light: #F0F0F0;
        
        /* Spacing and layout */
        --eco-border-radius: 12px;
        --eco-border-radius-lg: 16px;
        --eco-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --eco-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
        --eco-shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
        
        /* Animation */
        --eco-transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 16px;
        line-height: 1.5;
        margin: 0;
        padding: 0;
        background: var(--eco-bg-primary);
        color: var(--eco-text-primary);
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100vh;
        overflow: hidden;
      }

      /* Header Navigation */
      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex: 0 0 auto;
        background: linear-gradient(135deg, var(--eco-primary) 0%, var(--eco-secondary) 100%);
        color: var(--eco-text-on-primary);
        padding: 16px 24px;
        box-shadow: var(--eco-shadow-md);
        position: relative;
        z-index: 100;
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-family: 'Space Grotesk', sans-serif;
        font-weight: 600;
        font-size: 1.25rem;
      }

      .nav-brand img {
        height: 40px;
        width: 40px;
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .nav-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: var(--eco-border-radius);
        font-size: 0.875rem;
        backdrop-filter: blur(10px);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--eco-success);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      /* Main Content Area */
      main {
        container-type: size;
        flex: 1;
        position: relative;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      /* Environmental Dashboard Layout */
      .dashboard-layout {
        display: grid;
        grid-template-columns: 320px 1fr;
        height: calc(100vh - 220px); /* Account for header and status cards */
        gap: 0;
        flex: 1;
        min-height: 0;
      }

      .sidebar {
        background: var(--eco-surface);
        border-right: 1px solid var(--eco-border);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .main-content {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
        background: var(--eco-surface);
      }

      /* Language Selector */
      .language-selector {
        padding: 16px;
        background: var(--eco-surface-variant);
        border-bottom: 1px solid var(--eco-border);
        display: flex;
        gap: 8px;
        flex: 0 0 auto;
      }

      .lang-btn {
        flex: 1;
        padding: 8px 12px;
        background: var(--eco-surface);
        border: 1px solid var(--eco-border);
        border-radius: var(--eco-border-radius);
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--eco-text-secondary);
        cursor: pointer;
        transition: var(--eco-transition);
      }

      .lang-btn.active {
        background: var(--eco-primary);
        color: var(--eco-text-on-primary);
        border-color: var(--eco-primary);
      }

      .lang-btn:hover:not(.active) {
        background: var(--eco-surface-variant);
        border-color: var(--eco-primary);
      }

      /* Environmental Status Cards */
      .env-status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        padding: 20px;
        background: var(--eco-bg-tertiary);
        border-bottom: 1px solid var(--eco-border);
        flex: 0 0 auto;
      }

      /* Chat Interface Styling */
      azc-chat {
        flex: 1;
        display: flex;
        flex-direction: column;
        max-width: none;
        margin: 0;
        background: var(--eco-surface);
      }

      azc-history {
        background: var(--eco-surface);
        border-bottom: 1px solid var(--eco-border);
        flex: 1;
        min-height: 0;
        overflow: auto;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .dashboard-layout {
          grid-template-columns: 1fr;
          grid-template-rows: auto 1fr;
        }
        
        .sidebar {
          border-right: none;
          border-bottom: 1px solid var(--eco-border);
          max-height: 200px;
        }
        
        .env-status-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 12px;
          padding: 16px;
        }
        
        .nav-brand {
          font-size: 1rem;
        }
        
        .nav-indicator {
          display: none;
        }
      }

      @media (max-width: 480px) {
        .env-status-grid {
          grid-template-columns: 1fr;
        }
        
        nav {
          padding: 12px 16px;
        }
        
        .nav-brand {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation Header -->
    <nav>
      <div class="nav-brand">
        <img src="/logo.svg" alt="EcoSentinel AI Logo" />
        <span>EcoSentinel AI</span>
      </div>
      <div class="nav-actions">
        <div class="nav-indicator">
          <div class="status-dot"></div>
          <span>Environmental Monitor Active</span>
        </div>
      </div>
    </nav>

    <!-- Main Dashboard -->
    <main>
      <!-- Environmental Status Overview -->
      <eco-dashboard id="envDashboard"></eco-dashboard>

      <!-- Main Chat Interface Layout -->
      <div class="dashboard-layout">
        <!-- Sidebar with Chat History -->
        <div class="sidebar">
          <div class="language-selector">
            <button id="lang-en" class="lang-btn active">English</button>
            <button id="lang-sw" class="lang-btn">Kiswahili</button>
          </div>
          <azc-history id="chatHistory"></azc-history>
        </div>

        <!-- Main Chat Interface -->
        <div class="main-content">
          <azc-chat id="chat"></azc-chat>
        </div>
      </div>
    </main>

    <script type="module" src="/src/index.ts"></script>
    <script>
      // Generate a unique ID and store it in local storage
      const userId = localStorage.getItem('userId') || crypto.randomUUID();
      localStorage.setItem('userId', userId);

      // Language configurations for EcoSentinel AI
      const languageConfigs = {
        en: {
          enablePromptSuggestions: true,
          promptSuggestions: [
            'ðŸŒŠ What is the flood risk in my area this week?',
            'ðŸŒ± When should I plant maize based on weather patterns?',
            'ðŸ’¨ How is the air quality in Nairobi today?',
            'ðŸŒ³ Are there any deforestation alerts in Central Kenya?',
            'âš ï¸ What environmental risks should I prepare for?',
            'ðŸ“ Give me hyperlocal environmental predictions',
            'ðŸ  How can my community adapt to climate change?',
            'ðŸš¨ What should I do during environmental emergencies?',
            'ðŸŒ¾ What crops are best for this season in my area?',
            'ðŸ’§ Is the water quality safe in my location?',
          ],
          strings: {
            promptSuggestionsTitle: 'Ask EcoSentinel AI about environmental risks and guidance',
            citationsTitle: 'Environmental Data Sources:',
            followUpQuestionsTitle: 'Related environmental questions:',
            chatInputPlaceholder: 'Ask about environmental risks, weather forecasts, or local guidance...',
            chatInputButtonLabel: 'Send environmental query',
            assistant: 'EcoSentinel AI',
            user: 'You',
            errorMessage: 'Environmental intelligence service is temporarily unavailable. Please try again.',
            newChatButton: 'New environmental query',
            retryButton: 'Retry environmental query',
          },
        },
        sw: {
          enablePromptSuggestions: true,
          promptSuggestions: [
            'ðŸŒŠ Ni hatari gani ya mafuriko katika eneo langu wiki hii?',
            'ðŸŒ± Ni wakati gani bora wa kupanda mahindi kulingana na hali ya hewa?',
            'ðŸ’¨ Je, ubora wa hewa Nairobi ni vipi leo?',
            'ðŸŒ³ Kuna onyo la ukataji misitu katika Kenya ya Kati?',
            'âš ï¸ Ni hatari gani za mazingira ninapaswa kujiandalia?',
            'ðŸ“ Nipe utabiri wa mazingira wa eneo langu',
            'ðŸ  Jamii yangu iwezaje kubadilika na mabadiliko ya tabianchi?',
            'ðŸš¨ Nifanye nini wakati wa dharura za mazingira?',
            'ðŸŒ¾ Ni mazao gani bora kwa msimu huu eneo langu?',
            'ðŸ’§ Je, ubora wa maji ni salama eneo langu?',
          ],
          strings: {
            promptSuggestionsTitle: 'Uliza EcoSentinel AI kuhusu hatari za mazingira na mwongozo',
            citationsTitle: 'Vyanzo vya Data ya Mazingira:',
            followUpQuestionsTitle: 'Maswali mengine yanayohusiana:',
            chatInputPlaceholder: 'Uliza kuhusu hatari za mazingira, utabiri wa hali ya hewa, au mwongozo wa eneo lako...',
            chatInputButtonLabel: 'Tuma swali la mazingira',
            assistant: 'EcoSentinel AI',
            user: 'Wewe',
            errorMessage: 'Huduma ya akili ya mazingira haipatikani kwa sasa. Tafadhali jaribu tena.',
            newChatButton: 'Mazungumzo mapya ya mazingira',
            retryButton: 'Jaribu tena swali la mazingira',
          },
        }
      };

      // Current language state
      let currentLanguage = localStorage.getItem('ecoSentinelLanguage') || 'en';

      // Language switching functionality
      function switchLanguage(lang) {
        currentLanguage = lang;
        localStorage.setItem('ecoSentinelLanguage', lang);
        
        // Update active button
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`lang-${lang}`).classList.add('active');
        
        // Update chat configuration
        window.chat.options = languageConfigs[lang];
        
        // Dispatch language change event for other components
        document.dispatchEvent(new CustomEvent('languageChanged', {
          detail: { language: lang }
        }));
        
        // Update navigation text
        updateNavigationLanguage(lang);
      }

      // Update navigation elements based on language
      function updateNavigationLanguage(lang) {
        const navIndicator = document.querySelector('.nav-indicator span');
        if (navIndicator) {
          navIndicator.textContent = lang === 'sw' 
            ? 'Ufuatiliaji wa Mazingira Unaendelea' 
            : 'Environmental Monitor Active';
        }
      }

      // Initialize chat components
      window.chatHistory.userId = userId;
      window.chatHistory.addEventListener('loadSession', (e) => {
        const { id, messages } = e.detail;
        window.chat.sessionId = id;
        window.chat.messages = messages;
      });

      window.chat.userId = userId;
      window.chat.options = languageConfigs[currentLanguage];
      window.chat.addEventListener('messagesUpdated', () => {
        window.chatHistory.refresh();
      });

      // Handle environmental dashboard status card clicks
      function handleStatusCardClick(event) {
        const { status } = event.detail;
        
        // Auto-populate chat with environmental query based on language
        let query;
        if (currentLanguage === 'sw') {
          query = `Niambie zaidi kuhusu ${status.title.toLowerCase()}: ${status.value} katika ${status.location}. Nifanye nini?`;
        } else {
          query = `Tell me more about ${status.title.toLowerCase()} status: ${status.value} in ${status.location}. What should I do?`;
        }
        
        window.chat.question = query;
      }

      // Set up event listeners when DOM is loaded
      document.addEventListener('DOMContentLoaded', () => {
        // Language switcher event listeners
        document.getElementById('lang-en').addEventListener('click', () => switchLanguage('en'));
        document.getElementById('lang-sw').addEventListener('click', () => switchLanguage('sw'));
        
        // Environmental dashboard event listener
        const envDashboard = document.getElementById('envDashboard');
        if (envDashboard) {
          envDashboard.addEventListener('status-card-click', handleStatusCardClick);
        }
        
        // Set initial language
        switchLanguage(currentLanguage);
      });
    </script>
  </body>
</html>
